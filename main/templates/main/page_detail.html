{% extends 'main/layout.html' %}

{% block title %}{{ page.title }} â€” {{ blog_user.blog_title }}{% endblock %}

{% block meta_description %}{{ page.body|truncatewords:16 }}{% endblock %}

{% block content %}
<main>
    {% if blog_user.blog_title %}
    <a href="{% url 'index' %}" class="pages-item-brand">{{ blog_user.blog_title }}</a>
    {% endif %}

    <h1 class="pages-item-title">{{ page.title }}</h1>

    {% if request.user.is_authenticated and request.subdomain == user.username %}
    <div class="pages-item-byline">
        Last updated on <time datetime="{{ page.updated_at|date:'Y-m-d' }}">{{ page.updated_at|date:'F j, Y' }}</time>
        | <a href="{% url 'page_update' page.slug %}">Edit page</a>
        | <a href="{% url 'page_delete' page.slug %}">Del</a>
    </div>
    {% endif %}

    <div class="pages-item-body">
        {{ page.body_as_html|safe }}
    </div>
</main>

{% if blog_user.subscriptions_enabled and blog_user.stripe_connect_account_id and blog_user.stripe_connect_price_id and not is_subscribed %}
<p>
    <a href="{% url 'marketplace_subscribe' %}" class="btn">Subscribe</a>
    </p>
{% endif %}

{% include 'partials/webring.html' %}

{% include 'partials/footer_blog.html' %}

{% endblock content %}

{% block scripts %}
{% if not blog_user.comments_on %}
<script>
    window.addEventListener('keypress', function (evt) {
        if (evt.key === 'u') {
            document.location.assign('/pages');
        } else if (evt.key === 'e') {
            let url = document.location.pathname + 'edit';
            document.location.assign(url);
        }
    });
</script>
{% endif %}
{% endblock scripts %}
